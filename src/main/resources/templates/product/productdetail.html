<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <!-- 소스위치 resources/static/bootstrap-4.6.2-dist/css/bootstrap.min.css -->
    <link rel="stylesheet" type="text/css" th:href="@{/js/bootstrap-4.6.2-dist/css/bootstrap.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}">

    <!-- Optional JavaScript -->
    <!-- 소스위치 resources/static/js/jquery-3.7.1.min.js -->
    <script type="text/javascript" th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap-4.6.2-dist/js/bootstrap.bundle.min.js}" ></script>
    <script type="text/javascript" th:src="@{/js/header.js}" ></script>

    <!-- Font Awesome 6 Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Gothic+A1&family=IBM+Plex+Sans+KR&family=Nanum+Gothic&family=Noto+Sans+KR:wght@100..900&family=Noto+Serif+KR:wght@200..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">

    <!-- google font -->
    <link href="https://fonts.googleapis.com/css2?family=Dongle:wght@700&family=Gugi&family=Moirai+One&display=swap" rel="stylesheet">


    <title>가지마켓</title>
    <link rel="icon" type="image/x-icon" th:href="@{/images/gaji.png}">

    <style type="text/css">
        body {
            font-family: "Noto Sans KR", sans-serif;
            font-optical-sizing: auto;
            font-style: normal;
        }
        .container {
            box-sizing: border-box;
            padding: 0;
            margin: 5% auto 3% auto;
            align-content: flex-start;
        }
        .carousel {
            max-width: 600px; /* 원하는 너비 */
            height: 350px; /* 원하는 높이 */
        }

        .carousel-inner img {
            width: 100%; /* 너비를 100%로 설정 */
            height: 350px; /* 고정된 높이 */
            object-fit: fill; /* 이미지 비율 유지 */
        }

        .product-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .product-price {
            font-size: 1.25rem;
            color: darkmagenta; /* 가격 색상 */
        }
        .btn-custom {
            background-color: #580DD2; /* 버튼 색상 */
            color: white;
        }
        .btn-custom:hover {
            background-color: #b916d2; /* 버튼 호버 색상 */
            color: white;
        }

    </style>

    <!-- 카카오 API 키 입력 -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=a76ee334caf87a1587c2f7fcd7b84570&libraries=services"></script>
    <script type="text/javascript">
        function initMap() {

            const address = '[[${product.address}]]'; // 기본값 설정

            console.log("주소:", address); // 주소 출력

            const geocoder = new kakao.maps.services.Geocoder();
            geocoder.addressSearch(address, function(results, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const mapContainer = document.getElementById('map'); // 지도를 표시할 div
                    const mapOptions = {
                        center: new kakao.maps.LatLng(results[0].y, results[0].x), // 좌표
                        level: 3 // 확대 레벨
                    };

                    const map = new kakao.maps.Map(mapContainer, mapOptions); // 지도 생성

                    const marker = new kakao.maps.Marker({
                        position: new kakao.maps.LatLng(results[0].y, results[0].x) // 마커 위치
                    });

                    marker.setMap(map); // 지도에 마커 추가

                } else if (status === kakao.maps.services.Status.ZERO_RESULT) {

                    console.error('주소 검색 실패: ZERO_RESULT');

                    alert('입력한 주소를 찾을 수 없습니다. 주소를 확인해 주세요.'); // 사용자에게 알림

                    // 대체 위치 설정 (서울 시청)
                    const mapContainer = document.getElementById('map');
                    const defaultPosition = new kakao.maps.LatLng(37.5665, 126.978); // 서울 시청 좌표
                    const mapOptions = {
                        center: defaultPosition,
                        level: 3
                    };
                    const map = new kakao.maps.Map(mapContainer, mapOptions);

                    const marker = new kakao.maps.Marker({
                        position: defaultPosition
                    });
                    marker.setMap(map);
                } else {
                    console.error('주소 검색 실패: ' + status);
                }
            });
        }

        kakao.maps.load(initMap);
    </script>

</head>
<body>
    <div th:replace="~{/fragment/header :: main_header}"></div>

    <div class="container">
        <div style="display: flex; align-items: center; justify-content: center;">
            <span style="font-weight: bold; font-size: 18pt;" th:text="${product.title}"></span>
            <span class="badge badge-pill badge-success ml-3" th:if="${product.completestatus.name() == 'FOR_SALE'}" th:text="'판매중'"></span>
            <span class="badge badge-pill badge-warning ml-3" th:if="${product.completestatus.name() == 'RESERVED'}" th:text="'예약중'"></span>
            <span class="badge badge-pill badge-secondary ml-3" th:if="${product.completestatus.name() == 'SOLD'}" th:text="'거래완료'"></span>
        </div>

        <hr>

        <div class="d-flex align-items-center">
            <!-- 상품이미지 -->
            <div class="carousel flex-grow-1">
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li th:each="vo, iterStat : ${images}"
                            th:class="${iterStat.index == 0} ? 'active' : ''"
                            th:data-target="'#carouselExampleIndicators'"
                            th:data-slide-to="${iterStat.index}"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div th:each="vo, iterStat : ${images}"
                             th:class="${iterStat.index == 0} ? 'carousel-item active' : 'carousel-item'">
                            <img th:src="@{'/images/productImg/' + ${vo.filename}}" class="d-block" alt="상품 이미지">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-target="#carouselExampleIndicators" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-target="#carouselExampleIndicators" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </button>
                </div>
            </div>

            <!-- 판매자 정보 -->
                <div style="width: 30%; text-align: center; margin-top:5%; margin-left:10%;">
                    <h5 class="mb-5">〓 판매자 정보 〓</h5>
                    <!-- 프로필 사진 -->
                    <div class="mb-2">
                        <div style="border-radius: 50%; overflow: hidden; width: 100px; height: 100px; margin: 0 auto;">
                            <img th:src="@{'/resources/files/' + ${product.member.profilePic}}" width="100" height="100" alt="">
                            <!-- 이미지 저장 운영 경로 C:\git\gaji-market\src\main\webapp\resources\files-->
                        </div>
                    </div>

                    <!-- 이름 -->
                    <div style="margin-bottom: 5%;">
                        <span style="font-size: 1.2rem;"><span class="font-weight-bold" style="color: #580DD2;" th:text="${product.member.nickname} + '님'"></span></span>
                        <span class="d-block" style="color: #b3b3b3;" th:text="${product.member.address.address}"></span>
                    </div>

                    <!-- 영양지수 -->
                    <div style="text-align: left; margin-bottom: 15%;">
                        <span>영양지수</span>
                        <i class="fa-solid fa-circle-info" style="color: #ccc;" title="영양지수는 가지마켓 사용자로부터 받은 칭찬, 후기, 비매너 평가 등을 종합해서 만든 매너 지표입니다."></i>
                        <div>
                            <span style="font-size: 1rem; display: block; text-align: right;" th:text="${product.member.mannerTemp} + '%'"></span> <!-- 퍼센트 표시 -->
                            <!-- 막대 표시 -->
                            <div style="width: 100%; background-color: #e0e0e0; border-radius: 5px;">
                                <div th:style="'height: 10px; background-color: #580DD2; border-radius: 5px; width: ' + ${product.member.mannerTemp} + '%;'"></div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item" th:if="${product.fkcategoryseq == 1}" th:text="디지털기기"></li>
                <li class="breadcrumb-item" th:text="'등록시간 : ' + ${product.writedate}"></li>
                <li class="breadcrumb-item" th:text="'끌올 ' + ${product.reuploadcount} + '회'"></li>
                <li class="breadcrumb-item" th:text="'조회수 ' +${product.viewcount}"></li>
            </ol>
        </nav>

        <!-- 상품 정보 -->
        <span class="badge badge-danger" th:if="${product.negostatus == '1'}" th:text="가격제안불가"></span>
        <span class="badge badge-success" th:if="${product.negostatus == '2'}" th:text="가격제안받기"></span>

        <span class="badge badge-secondary" th:if="${product.salestype == '1'}" th:text="판매"></span>
        <span class="badge badge-info" th:if="${product.salestype == '2'}" th:text="나눔"></span>

        <div class="" style="margin-top:5%; margin-bottom: 10%;">
            <h2 class="product-title" th:text="${product.title}"></h2>
            <p class="product-price mt-3">
                <strong th:text="'희망가격 : ' + ${#numbers.formatInteger(product.price, 0, 'COMMA')} + '원'"></strong>
            </p>
            <p class="md-5" th:text="${product.content}"></p>

            <p class="product-address mt-5">
                <strong th:text="'거래희망장소 : ' + ${product.address}"></strong>
            </p>

            <!-- 카카오 지도 표시 -->
            <div id="map" style="height: 500px; width: 100%;"></div>

            <div class="d-flex justify-content-between mt-5">
                <button class="btn btn-secondary" onclick="location.href='http://localhost:8080/gaji/productList';">목록보기</button>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-success mr-5" type="button" th:if="${product.fkMemberSeq == memberSeq}" th:text="'수정하기'"></button>
                    <button class="btn btn-outline-danger" type="button" th:if="${product.fkMemberSeq == memberSeq}" th:text="'삭제하기'"></button>
                    <button class="btn btn-outline-danger mr-5" type="button" th:if="${product.fkMemberSeq != memberSeq}" th:text="'찜하기❤️'"></button>
                    <button class="btn btn-custom" type="button" th:if="${product.fkMemberSeq != memberSeq}" onclick="location.href='http://localhost:8080/gaji/chatting';">채팅하기</button>
                </div>
            </div>
        </div>
    </div>


    <div th:replace="~{fragment/footer :: footer}"></div>
</body>



</html>