<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>가지마켓</title>
  <link rel="icon" type="image/x-icon" th:href="@{/images/gaji.png}">

  <!-- CSS -->
  <link rel="stylesheet" type="text/css" th:href="@{/js/bootstrap-4.6.2-dist/css/bootstrap.min.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}">

  <!-- Google font, Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dongle:wght@700&family=Gugi&family=Moirai+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&family=Dongle:wght@700&family=Gugi&family=Moirai+One&display=swap" rel="stylesheet">

  <!-- Optional JavaScript -->
  <script type="text/javascript" th:src="@{/js/jquery-3.7.1.min.js}"></script>
  <script type="text/javascript" th:src="@{/js/bootstrap-4.6.2-dist/js/bootstrap.bundle.min.js}"></script>
  <script type="text/javascript" th:src="@{/js/header.js}" ></script>

  <style>
    body {
      margin: 0;
      font-family: "Noto Sans KR", sans-serif;
    }

	i.fa-bell:hover {
	  color: #b287f7 !important;
	  cursor: pointer;
	}
	
	span#keyword:hover {
		color: #b287f7 !important;
		cursor: pointer;
	}
	
    i.fa-circle-info:hover {
      color: #b287f7 !important;
    }

    div.sidebtn:hover {
      cursor: pointer;
      border: solid 1px #580DD2 !important;
      color: #580DD2 !important;
    }

    div.sidebtn:hover a {
      text-decoration: none;
      color: #580DD2 !important;
    }

    span.count:hover {
      cursor: pointer;
      text-decoration: underline;
      text-decoration-color: #580DD2;
    }
  </style>
</head>
<body>
  <div th:replace="~{/fragment/header :: main_header}"></div>

  <div class="container" style="width: 80%;">
    <div style="margin-top: 5%;">
      <h2 class="text-center">마이페이지</h2>
    </div>
    <div class="d-flex" style="margin: 5% 0;">
      <div style="width: 30%; text-align: center;">
        <div style="margin: 3% 12%;">

          <!-- 프로필 사진 -->
          <div class="mb-2">
            <div style="border-radius: 50%; overflow: hidden; width: 100px; height: 100px; margin: 0 auto;">
              <img th:src="@{/images/mypage/nyang.jpg}" width="100">
            </div>
          </div>

          <!-- 이름 -->
          <div style="margin-bottom: 5%;">
            <span style="font-size: 1.2rem;"><span class="font-weight-bold" style="color: #580DD2;" data-mypage="name"></span> 님</span>
            <span class="d-block" style="color: #b3b3b3; " data-mypage="address"></span>
          </div>

          <!-- 영양지수 -->
          <div style="text-align: left; margin-bottom: 15%;">
            <span>영양지수</span>
            <i class="fa-solid fa-circle-info" style="color: #ccc;" title="영양지수는 가지마켓 사용자로부터 받은 칭찬, 후기, 비매너 평가 등을 종합해서 만든 매너 지표입니다."></i>
            <div>
              <span style="font-size: 1rem; display: block; text-align: right;" data-mypage="mannerTemp"></span> <!-- 퍼센트 표시 -->
              <div style="width: 100%; background-color: #e0e0e0; border-radius: 5px;">
                <div data-mypage="mannerTempBar" style="height: 10px; background-color: #580DD2; border-radius: 5px;"></div>
              </div>
            </div>
          </div>

          <!-- 내 정보 수정 & 로그아웃 -->
          <div class="mb-3">
            <div class="d-flex align-items-center justify-content-center sidebtn" style="border: solid 1px #ccc; border-radius: 30px; height: 40px; color: #808080;"><a th:href="@{/myedit}" style="color: #808080;">내 정보 수정</a></div>
          </div>

          <div>
            <div class="d-flex align-items-center justify-content-center sidebtn" style="border: solid 1px #ccc; border-radius: 30px; height: 40px; color: #808080;" th:onclick="'window.location.href=\'' + @{/logout} + '\''">로그아웃</div>
          </div>

        </div>
      </div>
      <div style="border-left: solid 1px #ccc; width: 70%;">
        <div style="margin: 3% 5%;">

          <div class="d-flex justify-content-center" style="border: solid 1px #ccc; border-radius: 20px;">
            <div class="d-flex flex-column align-items-center justify-content-center" style="width: 25%; height: 150px; margin: 2% 0;" th:onclick="'window.location.href=\'' + @{/myPage/onSale} + '?memberSeq=' + ${memberSeq} + '\''">
              <i class="fa-regular fa-handshake mb-2" style="font-size: 1.2rem;"></i>
              <span class="d-block text-center">판매중인목록</span>
              <span class="count mt-2 font-weight-bold text-center" style="font-size: 1.2rem;"><span style="color: #580DD2; font-size: 1.5rem;" data-mypage="onSaleCount" ></span>&nbsp;개</span>
            </div>
            <div class="d-flex flex-column align-items-center justify-content-center" style="border-left: solid 1px #e6e6e6; width: 25%; height: 150px; margin: 2% 0;">
              <i class="fa-solid fa-check mb-2" style="font-size: 1.2rem;"></i>
              <span class="d-block text-center">거래완료목록</span>
              <span class="count mt-2 font-weight-bold text-center" style="font-size: 1.2rem;"><span style="color: #580DD2; font-size: 1.5rem;" data-mypage="soldCount"></span>&nbsp;개</span>
            </div>
            <div class="d-flex flex-column align-items-center justify-content-center" style="border-left: solid 1px #e6e6e6; width: 25%; height: 150px; margin: 2% 0;">
              <i class="fa-regular fa-credit-card mb-2" style="font-size: 1.2rem;"></i>
              <span class="d-block text-center">구매예약목록</span>
              <span class="count mt-2 font-weight-bold text-center" style="font-size: 1.2rem;" th:onclick="'location.href=\'' + @{/myPage/reservationList} + '?memberSeq=' + ${memberSeq} + '\''"><span style="color: #580DD2; font-size: 1.5rem;" data-mypage="reservationCount"></span>&nbsp;개</span>
            </div>
            <div class="d-flex flex-column align-items-center justify-content-center" style="border-left: solid 1px #e6e6e6; width: 25%; height: 150px; margin: 2% 0;">
              <i class="fa-regular fa-heart mb-2" style="font-size: 1.2rem;"></i>
              <span class="d-block text-center">찜한상품</span>
              <span class="count mt-2 font-weight-bold text-center" style="font-size: 1.2rem;" th:onclick="'window.location.href=\'' + @{/likeproduct} + '\''"><span style="color: #580DD2; font-size: 1.5rem;" data-mypage="likedProductCount"></span>&nbsp;개</span>
            </div>
          </div>

          <div class="row" style="border-top: solid 1px #ccc; border-bottom: solid 1px #ccc; margin: 10% 0.5% 0 0.5%;">
            <div class="col" style="width: 50%;">
              <div class="m-2 d-flex align-items-center justify-content-between" style="height: 50px;">
                <div>
                  <i class="fa-solid fa-award mr-2" style="font-size: 1.2rem;"></i>
                  <span>활동뱃지</span>
                </div>
                <div>
                  <span class="font-weight-bold" style="color:#580DD2;">10개</span>
                  <i class="fa-solid fa-angle-right ml-2" style="color: #ccc;"></i>
                </div>
              </div>
            </div>
            <div class="col" style="width: 50%; border-left: solid 1px #ccc;">
              <div class="m-2 d-flex align-items-center justify-content-between" style="height: 50px;">
                <div>
                  <i class="fa-solid fa-users mr-2" style="font-size: 1.2rem;"></i>
                  <span>거래리뷰</span>
                </div>
                <div>
                  <span class="font-weight-bold" style="color:#580DD2;" data-mypage="reviewCount"></span>
                  <i class="fa-solid fa-angle-right ml-2" style="color: #ccc;"></i>
                </div>
              </div>
            </div>
            <div class="w-100"></div>
            <div class="col" style="width: 50%; border-top: solid 1px #ccc;">
              <div class="m-2 d-flex align-items-center justify-content-between" style="height: 50px;">
                <div>
                  <i class="fa-solid fa-location-dot mr-2" style="font-size: 1.2rem;"></i>
                  <span>내 동네 설정</span>
                </div>
                <div>
                  <i class="fa-solid fa-angle-right ml-2" style="color: #ccc;"></i>
                </div>
              </div>
            </div>
            <div class="col" style="width: 50%; border-top: solid 1px #ccc; border-left: solid 1px #ccc;">
              <div class="m-2 d-flex align-items-center justify-content-between" style="height: 50px;">
				
				<div>
				  <i class="fa-regular fa-bell mr-2" style="font-size: 1.2rem;" data-toggle="modal" data-target="#keywordModal"></i>
				  <span id="keyword" data-toggle="modal" data-target="#keywordModal">키워드 알림 설정</span>
				</div>
				
                <div>
                  <i class="fa-solid fa-angle-right ml-2" style="color: #ccc;"></i>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Modal Structure -->
  <div class="modal fade" id="keywordModal" tabindex="-1" role="dialog" aria-labelledby="keywordModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="keywordModalLabel">키워드 알림 설정</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <h6>현재 설정된 키워드</h6>
          <ul id="keywordList">
          </ul>
          <hr>
          <h6>키워드 추가</h6>
          <input type="text" class="form-control" id="newKeyword" placeholder="키워드를 입력하세요">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
          <button type="button" class="btn btn-primary" id="addKeywordBtn">확인</button>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
      const memberSeq = '[[${memberSeq}]]';
      const contextPath = '[[@{/}]]';
      fetch(contextPath + 'api/v1/users/my-page-info?memberSeq=' + memberSeq)
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then(data => {
                // Update the page with the fetched data
                document.querySelector('[data-mypage="name"]').textContent = data.name;
                document.querySelector('[data-mypage="mannerTemp"]').textContent = data.mannerTemp + '%';
                document.querySelector('[data-mypage="mannerTempBar"]').style.width = data.mannerTemp + '%';
                document.querySelector('[data-mypage="onSaleCount"]').textContent = data.onSaleCount;
                document.querySelector('[data-mypage="soldCount"]').textContent = data.soldCount;
                document.querySelector('[data-mypage="reservationCount"]').textContent = data.reservationCount;
                document.querySelector('[data-mypage="likedProductCount"]').textContent = data.likedProductCount;
                document.querySelector('[data-mypage="reviewCount"]').textContent = data.reviewCount + '개';
                document.querySelector('[data-mypage="address"]').textContent = data.address;
              })
              .catch(error => {
                console.error('There was a problem with the fetch operation:', error.message);
                // Optionally, update the UI to show an error message
              });
    });
  </script>
  
  <script>
     document.addEventListener('DOMContentLoaded', function () {
       document.getElementById('addKeywordBtn').addEventListener('click', function () {
         const newKeyword = document.getElementById('newKeyword').value;
         if (newKeyword.trim()) {
			
			$.ajax({
			    url: '/gaji/insertkeyword',
			    type: 'POST',
			    data: { newKeyword: newKeyword }, // productId를 데이터로 전달
			    success: function(result) {
		           alert('새 키워드 "' + newKeyword + '"가 추가되었습니다.');

				   location.reload(); // 페이지 새로고침
			    },
			    error: function(xhr, status, error) {
			        alert("이미 등록된 키워드 이거나, 오류가 발생했습니다.")
					console.error('Failed to insert keyword:', error); // 에러 처리
			    }
			});
			
           // Here you can add the logic to actually save the new keyword to the server
           $('#keywordModal').modal('hide');  // Close the modal after adding the keyword
         } else {
           alert('키워드를 입력하세요.');
         }
       });
	   
		$.ajax({
		    url: '/gaji/keywordlist',
		    type: 'POST',
		    success: function(result) {
		        const keywordList = $('#keywordList');

		        $.each(result, function(index, keyword) {
		            keywordList.append('<li>' + keyword.word + '</li>');
		        });

		        $('#keywordModal').modal('hide');  // 모달 닫기
				
		    },
		    error: function(xhr, status, error) {
		        console.error('Failed to load keyword list:', error);
		    }
		});
	   	
	       // Here you can add the logic to actually save the new keyword to the server
	       $('#keywordModal').modal('hide');  // Close the modal after adding the keyword
	   });
	   
	   
	 
	 
   </script>

  <div th:replace="~{/fragment/footer :: footer}"></div>
</body>
</html>